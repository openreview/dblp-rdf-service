# Dev tasks/notes

## Overview
For every person/author profile in  OpenReview, supplement their set of authored
papers by identifying them in DBLP and uploading any dblp records (as new notes)
that are not  already recorded present. As dblp.org updates  their database with
new papers, add any new entries into OpenReview

## Currently implemented procedure

The following table shows the data that is retrieved, examined, and amended if
necessary.

- Starting with an authorID, e.g., ~Sebastian_Thrun1
- Fetch the openreview author profile, which contains a field like
   `{content.dblp: 'https://dblp.org/pid/m/SebastianThrun'}`
- Normalize the value of content.dblp
  - A GET is performed on the content.dblp URL, following any redirects, until
    the final URL is reached, and is the normalized dblp author URL.
- Derive the authorPID from authorURL, e.g., /m/SebastianThrun

- Populate the table
  - /notes column is generated by querying openreview for all papers attributed to an author
  - dblp.org column is generated by fetching from, e.g., https://dblp.org/pid/m/SebastianThrun.html
  - dblp.org authorIndex is generated by pid comparison between dblp entry and authorPID
  - /notes and dblp.org columns are aligned by exact title matches between the papers
  - /search column is generated (if needed), by searching titles in openreview

```
|------------------------+----------------+-----------------------------|
| /notes                 | /search        | dblp.org                    |
|------------------------+----------------+-----------------------------|
| note:                  | same as /notes | title: Thrun P20...         |
| _id: note#1            |                | authorIndex: 2              |
| _content:              |                | note: {                     |
| __title: 'Thrun P20..' |                | _content: {                 |
| __authorids: []        |                | __dblp: http://.../ThrunP20 |
|                        |                | ...                         |
|------------------------+----------------+-----------------------------|
| *note#2 w/o dblp entry |                |                             |
|------------------------+----------------+-----------------------------|
|                        | *possible      | dblp entry w/o note         |
|                        | title match    |                             |
|                        |                |                             |
|------------------------+----------------+-----------------------------|
```

- Procedure:
 - Consider only those rows that have a dblp.org entry, but no /notes entry
 - perform a title search in openreview using dblp entry
   - if matching paper found with the Profile author in its author list (e.g.,
     'Sebastian Thrun') POST an updated to the openreview note with
     content.authors updated to contain the id (~Sebastian_Thrun1) for the
     profile author
   - if matching paper is found w/o an author name match, OR if no paper is found
     - POST a new paper to /note endpoint and then update it to include the
       correct authorID

Note: updates  POSTed to openreview are  done using the /references  endpoint to
create a record  with field 'referent' set  to the note.id, *not*  by posting to
the original note

### Questions about current procedure
- When creating new notes for dblp records, should content include title/authors field?
  - Currently only the content.dblp and content.authorids field are created.
  - Given that /search is based on title, if a paper is inserted for, say,
    author#1, then author#2 will not be able to find that same record and insert
    their id into authorids field.

- Should note _bibtex field be populated (or any other content fields that can
  be derived from dblp)?
  - if so, just in newly created notes, or backfill any missing in old notes?

- Current system seems to only upload new papers if there are no papers of any
  kind for that author. Is this a desired behavior under any circumstances?


This line makes no sense to me:
    >>  if (dblpUrlCandidateSplit[1].startsWith('pid') || dblpUrlCandidateSplit[1].startsWith('~ley')) {


## Proposed expanded procedure
- New data comes from one of several places
  - Newly downloaded records from dblp.org may contain new papers for existing
    authors
  - Newly created profiles, which may contain the content.dblp field






## Requirements


### Components
### Local copy of dblp database
- create
- Update dblp data to latest version




### Deployment


## Tasks


- scripts to download most recent dblp.ttl data and load into Jena
- scripts to setup and run Jena server

### Extraction Service process


- Construct a record of the form (which will form the POST of an initial note)
```
      return {
        note: {
          content: {
            dblp: publicationNode.toString()
          },
          invitation: 'dblp.org/-/record',
          readers: ['everyone'],
          writers: ['dblp.org'],
          signatures: ['dblp.org']
        },
        title: publicationNode.getElementsByTagName('title')[0].textContent,
        authorIndex: Array.from(publicationNode.getElementsByTagName('author')).map(p => p.getAttribute('pid')).indexOf(authorPidInXML)
      };
```

- If note exist in OpenReview, POST update
```

  let updateNoteObject = {
    id: referenceId,
    referent: paperId,
    invitation: 'dblp.org/-/author_coreference',
    signatures: ['dblp.org'],
    readers: ['everyone'],
    writers: [],
    content: {
      authorids: authorIds
    }
```
